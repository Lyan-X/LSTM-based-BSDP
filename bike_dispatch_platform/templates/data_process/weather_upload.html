{% extends "base.html" %}  <!-- 继承你的基础模板，和骑行数据上传模板保持一致 -->
{% block title %}天气数据上传 - 共享单车需求预测系统{% endblock %}
{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">天气数据上传</h2>

    <!-- 天气数据上传表单：必须加enctype="multipart/form-data"才能上传文件 -->
    <form method="post" enctype="multipart/form-data" class="mb-4">
        {% csrf_token %}  <!-- Django必加的防跨站攻击令牌 -->
        <div class="mb-3">
            <label class="form-label">{{ form.data_source.label }}</label>
            {{ form.data_source }}  <!-- 已删除add_class过滤器，直接渲染 -->
            <div class="form-text">填写数据来源，如：公开天气数据集、本地采集</div>
        </div>
        <div class="mb-3">
            <label class="form-label">{{ form.file.label }}</label>
            {{ form.file }}  <!-- 已删除add_class过滤器，直接渲染 -->
            <div class="form-text">仅支持CSV/Excel格式，表头需包含：区域、日期、温度、湿度、风速、降雨量、天气类型</div>
        </div>
        <button type="submit" class="btn btn-primary">上传并入库</button>
    </form>

    <!-- 提示信息：显示成功/失败的提示 -->
    {% if messages %}
        {% for msg in messages %}
            <div class="alert alert-{{ msg.tags }} alert-dismissible fade show" role="alert">
                {{ msg }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}

    <!-- 最近上传的10条天气数据预览 -->
    {% if weather_list %}
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">最近上传的天气数据（前10条）</h5>
            </div>
            <div class="card-body">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th>区域</th>
                            <th>日期</th>
                            <th>温度(℃)</th>
                            <th>湿度(%)</th>
                            <th>风速(m/s)</th>
                            <th>天气类型</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for weather in weather_list %}
                            <tr>
                                <td>{{ weather.area }}</td>
                                <td>{{ weather.date }}</td>
                                <td>{{ weather.temperature }}</td>
                                <td>{{ weather.humidity }}</td>
                                <td>{{ weather.wind_speed }}</td>
                                <td>
                                    {% if weather.weather_type == 'sunny' %}晴
                                    {% elif weather.weather_type == 'cloudy' %}阴
                                    {% elif weather.weather_type == 'rain' %}雨
                                    {% else %}{{ weather.weather_type }}{% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}